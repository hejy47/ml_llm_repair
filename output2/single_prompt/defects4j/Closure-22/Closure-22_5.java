There are no clear indications of what is causing the bug, nor what should be the desired behaviour. Additional information is needed to provide a fix for the function.